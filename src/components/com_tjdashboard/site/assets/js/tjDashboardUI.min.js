var TJDashboardUI={initDashboard:function(a){TJDashboardService.getDashboard(a).done(function(t){if(jQuery(".tjdashboard-loader").hide(),!t.data.dashboard_id)return!1;if(t.data.widget_data.length<=0)return jQuery('<div class="alert alert-info">'+Joomla.JText._("COM_TJDASHBOARD_WIDGETS_NOTSHOW_ERROR_MESSAGE")+"</div>").appendTo(".tjdashboard"),!1;var i=0,o=0,n=1,s="";return jQuery('<div class="row dashboard-widget-row-'+n+'">').appendTo(".tjdashboard"),jQuery.each(t.data.widget_data,function(a,e){var r="panel-default",d="";if(e.params)try{e.params=JSON.parse(e.params),e.params.color&&(r=e.params.color),e.params.icon&&(d=e.params.icon)}catch(a){e.params={}}s="chartjs.tjdashgraph"==e.renderer_plugin?"tjloader--chart":"tabulator.tjdashtable"==e.renderer_plugin?"tjloader--tabulator":"tjloader--default",jQuery('<div class="col-xs-'+e.size+'"><div class="widget-data panel '+r+'"><div class="widget-title panel-heading"><span class="'+d+'" aria-hidden="true"></span> <b>'+e.title+'</b><span id="view-all-'+e.dashboard_widget_id+'" class="pull-right"></span></div><div data-dashboard-widget-id="'+e.dashboard_widget_id+'" id="dashboard-widget-'+e.dashboard_widget_id+'" class="'+s+'"></div></div></div>').appendTo(".dashboard-widget-row-"+n),TJDashboardUI.initWidget(e),o++,12===(i=parseInt(i)+parseInt(e.size))&&t.data.widget_data.length!==o&&(n++,jQuery('</div><div class="row dashboard-widget-row-'+n+'">').appendTo(".tjdashboard"),i=0),t.data.widget_data.length===o&&jQuery("</div>").appendTo(".tjdashboard")}),!0})},initWidget:function(u){TJDashboardService.getWidget(u.dashboard_widget_id).done(function(a){if(!a.data.dashboard_widget_id)return jQuery('<div class="alert alert-info">'+Joomla.JText._("COM_TJDASHBOARD_NO_DATA_AVAILABLE_MESSAGE")+"</div>").appendTo("#dashboard-widget-"+u.dashboard_widget_id),!1;if(!TJDashboardUI._validWidget(a.data.widget_render_data)||0==a.data.widget_render_data.length)return jQuery('<div class="alert alert-info">'+Joomla.JText._("COM_TJDASHBOARD_NO_DATA_AVAILABLE_MESSAGE")+"</div>").appendTo("#dashboard-widget-"+a.data.dashboard_widget_id),!1;jQuery(window).trigger("resize");var e=[];e.element="dashboard-widget-"+a.data.dashboard_widget_id,e.data=a.data.widget_render_data,e.params=u.params;var r=a.data.renderer_plugin.split("."),d=r[0],t=r[1];if(!e&&!a.data.renderer_plugin)return!1;var i=[],o=0,n=JSON.parse(e.data),s="";if(n.links){o=n.links.length,i=n.links;for(var _=0;_<o;_++)s=s+' <a href="'+i[_].link+'">'+i[_].title+"</a> ";jQuery("#view-all-"+a.data.dashboard_widget_id).replaceWith('<span id="view-all-'+a.data.dashboard_widget_id+'" class="pull-right">'+s+"</span>")}var l="TJDashboard"+TJDashboardUI._jsUcFirst(d);return TJDashboardUI._addCssFiles(a.data.widget_css),TJDashboardUI._addJsFiles(a.data.widget_js,t,e,l),!0})},_addCssFiles:function(a){jQuery.each(a,function(a,e){var r=document.createElement("link");r.href=e,r.type="text/css",r.rel="stylesheet",0==jQuery.find("link [href='"+e+"']").length&&jQuery("head").append(r)})},_addJsFiles:function(a,r,d,t){jQuery.each(a,function(a,e){jQuery.getScript(e,function(){window[t].renderData(r,d)})})},_validWidget:function(a){try{JSON.parse(a)}catch(a){return!1}return!0},_jsUcFirst:function(a){return a.charAt(0).toUpperCase()+a.slice(1)},_setRenderers:function(){var a=jQuery("#jform_data_plugin").val(),e=jQuery("#jform_renderer_plugin").val(),r=TJDashboardService.getRenderers(a);jQuery("#jform_renderer_plugin").replaceWith('<select id="jform_renderer_plugin" name="jform[renderer_plugin]" class="required" required="required" aria-required="true"><option value="">'+Joomla.JText._("COM_TJDASHBOARD_WIDGET_FORM_RENDERER_PLUGIN")+"</option></select>"),jQuery("#jform_renderer_plugin").find("option").not(":first").remove(),r.done(function(a){var r=jQuery("#jform_renderer_plugin");jQuery.each(a.data,function(a,e){r.append(new Option(e,a))}),jQuery("#jform_renderer_plugin").val(e)}),TJDashboardService.getWidgetParams(a).done(function(a){jQuery("#jform_params").val(a.data)})},_setSize:function(){var a=jQuery("#jform_size").val();jQuery("#jform_size").replaceWith('<select id="jform_size" name="jform[size]" class="inputbox required" required="required" aria-required="true"><option value="">Select Size</option><option value="12">'+Joomla.JText._("COM_TJDASHBOARD_WIDGET_FORM_FULL_WIDTH")+'</option><option value="6">'+Joomla.JText._("COM_TJDASHBOARD_WIDGET_FORM_HALF_WIDTH")+'</option><option value="4">'+Joomla.JText._("COM_TJDASHBOARD_WIDGET_FORM_ONE_THIRD_WIDTH")+'</option><option value="3">'+Joomla.JText._("COM_TJDASHBOARD_WIDGET_FORM_ONE_FOURTH_WIDTH")+"</option></select>"),jQuery("#jform_size").val(a)}};